{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "location": {
        "type": "string",
        "metadata": {
          "description": "The Azure location to deploy all resources"
        },
        "allowedValues": [
          "japaneast",
          "eastus2",
          "westeurope",
          "southeastasia",
          "southcentralus",
          "australiaeast",
          "koreacentral",
          "westus2",
          "brazilsouth",
          "uksouth",
          "westcentralus",
          "northeurope",
          "canadacentral",
          "australiasoutheast",
          "centralindia",
          "francecentral"
          ]
      },
      "appName": {
         "type": "string"
      },
      "_artifactsLocation": {
        "type": "string",
        "metadata": {
          "description": "Path to the nested templates used in this deployment"
        },
        "defaultValue": "https://raw.githubusercontent.com/DCMattyG/azure-projects/master/vmss-linux-dsc/"
      },
      "_artifactsLocationSasToken": {
        "type": "string",
        "metadata": {
          "description": "SAS token to access artifacts location, if required"
        },
        "defaultValue": ""
      }
    },
    "functions": [],
    "variables": {
      "publicIpAddress": "[uri(parameters('_artifactsLocation'), concat('nested/publicIpAddress.json', parameters('_artifactsLocationSasToken')))]",
      "networks": "[uri(parameters('_artifactsLocation'), concat('nested/networks.json', parameters('_artifactsLocationSasToken')))]"
    },
    "resources": [
      {
        "name": "publicIPAddress",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2018-02-01",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[variables('publicIpAddress')]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "location": {
              "value": "[parameters('location')]"
            },
            "appName": {
              "value": "[parameters('appName')]"
            }
          }
        }
      },
      {
        "name": "networks",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2018-02-01",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[variables('networks')]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "location": {
              "value": "[parameters('location')]"
            },
            "appName": {
              "value": "[parameters('appName')]"
            }
          }
        }
      }
    ],
    "outputs": {}
}
